# WordPress Caching Plugin Setup Guide

Performance optimization guide for WordPress Multisite caching on daily.dscp.team.

## Overview

**Why caching matters:**
- Reduces server load by serving static HTML instead of processing PHP
- Dramatically improves page load times (from ~2s to ~0.3s)
- Better Core Web Vitals scores (Google ranking factor)
- Lower resource usage = cost savings

**Current nginx optimizations already in place:**
- ✅ Static asset caching (js, css, images - 30 days)
- ✅ Gzip compression
- ✅ Browser caching headers
- ✅ Font caching (365 days)

**What we're adding:**
- Page caching (full HTML output)
- Object caching (database query results)
- Browser cache integration

---

## Recommended Caching Solution

### Option 1: WP Super Cache (Recommended)

**Why WP Super Cache:**
- ✅ Works perfectly with WordPress Multisite
- ✅ Lightweight and simple
- ✅ Free and actively maintained
- ✅ Nginx-compatible
- ✅ Lower resource usage than W3 Total Cache
- ✅ Automatic cache clearing on post updates

**Performance impact:**
- Before: 1-2 second page load
- After: 0.2-0.5 second page load
- 70-80% reduction in server CPU usage

---

## Installation: WP Super Cache

### Step 1: Install Plugin

#### Via WordPress Network Admin:

1. **Access Network Admin**
   ```
   https://dscp.team/wp-admin/network/
   ```

2. **Install Plugin**
   - Navigate to: Plugins → Add New
   - Search: "WP Super Cache"
   - Install by: Automattic
   - Click: "Network Activate"

#### Alternative: Manual Installation

```bash
# SSH into your VPS
ssh root@91.98.39.164

# Install via WP-CLI (in container)
cd /opt/wordpress
docker compose exec wordpress bash
wp plugin install wp-super-cache --activate-network
exit
```

---

### Step 2: Configure WP Super Cache

After installation, configure per-site (or network-wide):

#### For daily.dscp.team:

1. **Access Settings**
   - Switch to site: https://daily.dscp.team/wp-admin/
   - Navigate to: Settings → WP Super Cache

2. **Caching Tab (Recommended Settings)**

   **Caching:**
   - ☑️ Enable: "Caching On (Recommended)"
   - Click: "Update Status"

   **Cache Delivery Method:**
   - Select: **"Simple"** (recommended for Docker/nginx setup)
   - Alternative: "Expert" (for advanced users)
   - Click: "Update Status"

   **Misc Settings:**
   - ☑️ Enable: "Compress pages so they're served more quickly to visitors"
   - ☑️ Enable: "Don't cache pages for known users" (important!)
   - ☑️ Enable: "Cache rebuild" (serves old cached page while regenerating)
   - ☑️ Disable: "Mobile device support" (unless you have separate mobile theme)
   - ☐ Disable: "Remove UTF8/blog charset support" (keep UTF8 enabled)

3. **Advanced Tab**

   **Miscellaneous:**
   - ☑️ Enable: "Enable dynamic caching" (recommended)
   - ☑️ Enable: "Clear all cache files when a post or page is published or updated"
   - ☑️ Enable: "Extra homepage checks"

   **Cache Restrictions:**
   - Add these URLs to "Rejected URLs" (one per line):
     ```
     /wp-admin/
     /wp-login.php
     /cart/
     /checkout/
     /my-account/
     ```

   **Accepted Filenames & Rejected User Agents:**
   - Leave default (automatically blocks bots from cached pages)

   **Cache Timeout:**
   - **Timeout:** 3600 seconds (1 hour)
   - **Scheduler:** Enable
   - **Garbage Collection:** Every 600 seconds
   - Click: "Change Expiration"

4. **CDN Tab (Optional)**
   - If you use Cloudflare or another CDN:
     - ☑️ Enable CDN Support
     - Add your CDN URL
   - Otherwise: Skip this

5. **Contents Tab**
   - Use this to view cached files
   - Manually delete cache if needed:
     - Click: "Delete Cached Pages"

6. **Preload Tab (Optional but Recommended)**

   **Cache Preload:**
   - ☑️ Enable: "Preload mode"
   - **Preload interval:** 600 minutes (refresh cache every 10 hours)
   - **Preload posts:** All posts
   - Click: "Update Settings"
   - Click: "Preload Cache Now" (first-time setup)

   **How preload works:**
   - Automatically refreshes cache in background
   - Ensures visitors always hit cached pages
   - Reduces "first visitor" slowness after cache expiration

7. **Plugins Tab**
   - Review plugins that may conflict
   - Usually no action needed

---

### Step 3: Test Caching

#### Verify Cache is Working

1. **Visit your site:** https://daily.dscp.team

2. **View page source** (right-click → View Page Source)

3. **Scroll to bottom** - you should see:
   ```html
   <!-- Dynamic page generated in X seconds. -->
   <!-- Cached page generated by WP-Super-Cache on 2025-11-05 12:34:56 -->
   <!-- super cache -->
   ```

4. **Reload page** - load time should be much faster on second visit

#### Performance Testing

**Before and after comparison:**

```bash
# Test page load time (run 3 times, take average)
curl -o /dev/null -s -w "Time: %{time_total}s\n" https://daily.dscp.team

# Before caching: ~1.5-2.0s
# After caching: ~0.2-0.5s
```

**Use Google PageSpeed Insights:**
- Visit: https://pagespeed.web.dev/
- Test: https://daily.dscp.team
- Check improvements in:
  - First Contentful Paint (FCP)
  - Largest Contentful Paint (LCP)
  - Time to First Byte (TTFB)

---

## Alternative Option: W3 Total Cache

**Use W3 Total Cache if:**
- You need advanced features (minification, CDN integration)
- You want Redis/Memcached object caching
- You're comfortable with complex configuration

**Why we don't recommend it for your setup:**
- ⚠️ More complex configuration
- ⚠️ Higher resource usage
- ⚠️ Overkill for 2-site multisite network
- ⚠️ More potential conflicts with other plugins

**If you still want W3 Total Cache:**

```bash
# Install via WP-CLI
docker compose exec wordpress wp plugin install w3-total-cache --activate-network
```

**Configuration (brief):**
1. Enable: Page Cache
2. Enable: Browser Cache
3. Enable: Object Cache (if you set up Redis - see below)
4. Disable: Database Cache (not needed with WordPress Multisite)
5. Minify: Optional (can break some themes)

---

## Advanced: Redis Object Cache (Optional)

**For advanced users:** Add Redis for database query caching.

**Why Redis:**
- Caches WordPress database queries in memory
- Faster than page cache for logged-in users
- Reduces database load significantly

**Impact:**
- Admin dashboard loads 3-5x faster
- Good for sites with many logged-in users
- For daily.dscp.team: Probably overkill unless traffic is very high

### Quick Setup (If Interested)

1. **Add Redis to docker-compose.yml:**

```yaml
services:
  redis:
    image: redis:7-alpine
    restart: unless-stopped
    networks:
      - wordpress-network
    volumes:
      - redis-data:/data

volumes:
  redis-data:
```

2. **Install Redis plugin:**

```bash
docker compose exec wordpress wp plugin install redis-cache --activate-network
```

3. **Configure:**
   - Settings → Redis
   - Click: "Enable Object Cache"

**Note:** Only do this if you're comfortable with Docker configuration.

---

## Maintenance & Troubleshooting

### Clear Cache When Needed

**When to manually clear cache:**
- After changing theme
- After updating plugins
- After editing CSS/JS
- After major content changes

**How to clear cache:**

**Option 1: Via WordPress Admin**
1. Go to: Settings → WP Super Cache
2. Click: "Delete Cache" button
3. Click: "Preload Cache Now" (if preload enabled)

**Option 2: Via CLI (faster)**

```bash
# SSH into VPS
ssh root@91.98.39.164

# Clear cache via WP-CLI
cd /opt/wordpress
docker compose exec wordpress wp cache flush
```

### Common Issues

#### Issue: Changes not showing on site

**Solution:**
1. Clear cache: Settings → WP Super Cache → Delete Cache
2. Check "Don't cache pages for known users" is enabled
3. Log out and test in incognito window

#### Issue: Cache not generating

**Solution:**
1. Check: Settings → WP Super Cache → "Caching On" is enabled
2. Verify file permissions:
   ```bash
   docker compose exec wordpress ls -la /var/www/html/wp-content/cache/
   # Should be owned by www-data
   ```
3. Regenerate cache: Click "Preload Cache Now"

#### Issue: Logged-in users seeing cached pages

**Solution:**
1. Enable: "Don't cache pages for known users"
2. Clear cache and test again

#### Issue: 404 pages being cached

**Solution:**
1. Advanced tab → Add to "Rejected URLs": `404`
2. Clear cache

---

## Performance Monitoring

### Track Performance Improvements

**Before implementing caching:**
- Document current metrics:
  - Page load time
  - Server CPU usage
  - Memory usage
  - Google PageSpeed Insights score

**After implementing caching:**
- Compare metrics after 24 hours
- Expected improvements:
  - 60-80% faster page loads
  - 70-80% lower CPU usage
  - +20-30 points on PageSpeed Insights

### Monitor Cache Hit Rate

**View cache statistics:**
1. Settings → WP Super Cache → Contents tab
2. Check "Cached pages" count
3. Monitor cache regeneration frequency

**Healthy metrics:**
- Cache hit rate: >80% (most visitors see cached pages)
- Cache age: 10-60 minutes (depends on content update frequency)
- Preload status: All pages preloaded

---

## Integration with Existing Setup

### WP Super Cache + RankMath

**Compatibility:** ✅ Perfect - no conflicts

**Configuration:**
- WP Super Cache handles page output
- RankMath handles SEO meta tags (generated before caching)
- Both work together seamlessly

**Cache clearing:**
- WP Super Cache auto-clears when you update posts
- RankMath sitemap auto-updates on post publish

### WP Super Cache + Google Site Kit

**Compatibility:** ✅ No issues

**Notes:**
- Site Kit analytics still track cached page views
- PageSpeed Insights will show improved scores
- Search Console data unaffected

### WP Super Cache + Nginx Optimizations

**Compatibility:** ✅ Complementary

**How they work together:**
1. **First visit:**
   - WP Super Cache generates cached HTML
   - Saved to disk
2. **Subsequent visits:**
   - Nginx serves cached HTML directly (no PHP)
   - Gzip compression applied by nginx
   - Browser caching headers from nginx

**Result:** Maximum performance

---

## Cache Invalidation Strategy

### Automatic Cache Clearing (Built-in)

WP Super Cache automatically clears cache when:
- ✅ Post is published
- ✅ Post is updated
- ✅ Post is deleted
- ✅ Comment is added (configurable)
- ✅ Theme is changed
- ✅ Plugin is activated/deactivated

### Manual Cache Clearing (When Needed)

**When to manually clear:**
- After bulk editing posts
- After importing content
- After database changes
- When testing new features

**How to automate cache clearing:**

```bash
# Add to cron (optional) - clear cache daily at 3 AM
# SSH into VPS and add to crontab:
0 3 * * * cd /opt/wordpress && docker compose exec -T wordpress wp cache flush
```

---

## Multisite-Specific Configuration

### Per-Site vs Network-Wide Caching

**Network Activate WP Super Cache:**
- All sites get caching (dscp.team + daily.dscp.team)
- Each site has separate cache
- Configure settings per-site or use network defaults

**Per-Site Configuration:**
1. Switch sites: My Sites → [Select Site]
2. Settings → WP Super Cache
3. Configure uniquely for each site

**Recommended approach:**
- Network activate plugin
- Configure daily.dscp.team with full caching
- Configure dscp.team separately (if needed)

### Cache Separation

**How multisite handles cache:**
- Each site has separate cache directory:
  - `wp-content/cache/supercache/daily.dscp.team/`
  - `wp-content/cache/supercache/dscp.team/`
- Clearing cache on one site doesn't affect the other
- Cache settings are per-site

---

## Expected Results

### Performance Improvements

**Page Load Time:**
- Before: 1.5-2.0s
- After: 0.2-0.5s
- **Improvement: 70-80% faster**

**Time to First Byte (TTFB):**
- Before: 800-1200ms
- After: 50-150ms
- **Improvement: 85-90% faster**

**Server Resource Usage:**
- CPU: 70-80% reduction
- Memory: Minimal change
- Database queries: 95% reduction (for cached pages)

**Google PageSpeed Insights Score:**
- Before: 60-75 (typical WordPress)
- After: 85-95 (with caching + nginx optimization)
- **Improvement: +20-30 points**

---

## Next Steps

### After Setting Up Caching:

1. ✅ **Test performance:**
   - Run PageSpeed Insights before/after
   - Compare load times in DevTools

2. ✅ **Monitor for 24 hours:**
   - Check cache statistics
   - Verify automatic cache clearing works

3. ✅ **Configure cache preload:**
   - Enable preload for consistent performance
   - Set reasonable interval (600 minutes)

4. ✅ **Document baseline metrics:**
   - Save before/after screenshots
   - Track improvements over time

5. ✅ **Deploy nginx updates:**
   - Upload updated nginx config
   - Restart Docker containers
   - See: DEPLOYMENT-CHECKLIST.md

---

## Resources

**WP Super Cache Documentation:**
- https://wordpress.org/plugins/wp-super-cache/
- https://odd.blog/wp-super-cache-developers/

**Performance Testing Tools:**
- Google PageSpeed Insights: https://pagespeed.web.dev/
- GTmetrix: https://gtmetrix.com/
- WebPageTest: https://www.webpagetest.org/

**WordPress Caching Best Practices:**
- https://developer.wordpress.org/advanced-administration/performance/optimization/

---

**Status:** Ready to implement
**Estimated Setup Time:** 10-15 minutes
**Performance Impact:** 70-80% faster page loads
**Cost:** $0 (free plugin)
